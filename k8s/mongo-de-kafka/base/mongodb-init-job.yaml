apiVersion: batch/v1
kind: Job
metadata:
  name: mongodb-init-replicaset
spec:
  template:
    spec:
      restartPolicy: OnFailure
      containers:
      - name: mongo-init
        image: mongo:7.0
        command:
        - /bin/bash
        - -c
        - |
          sleep 30
          mongosh --host mongodb-0.mongodb-headless.mongo-de-kafka.svc.cluster.local:27017 \
            -u admin -p password --authenticationDatabase admin <<EOF
          rs.initiate({
            _id: "rs0",
            members: [
              { _id: 0, host: "mongodb-0.mongodb-headless.mongo-de-kafka.svc.cluster.local:27017", priority: 2 },
              { _id: 1, host: "mongodb-1.mongodb-headless.mongo-de-kafka.svc.cluster.local:27017", priority: 1 }
            ]
          });
          EOF
          echo "Replica set initialized"
